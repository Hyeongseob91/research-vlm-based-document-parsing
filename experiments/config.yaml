# Experiment Configuration
# This file controls all experimental variables for reproducibility

version: "1.0"
experiment_name: "vlm_document_parsing_evaluation"
created_at: "2025-01-22"

# =============================================================================
# Dataset Configuration
# =============================================================================
datasets:
  base_path: "data"
  test_cases:
    - id: "test_1"
      name: "Korean Government Document"
      pdf_path: "data/test_1/test_data_1.pdf"
      gt_path: "data/test_1/gt_data_1.md"
      language: "korean"
      document_type: "digital"
      features: ["tables", "headers", "lists"]

    - id: "test_2"
      name: "Receipt Image"
      pdf_path: "data/test_2/test_data_2.jpg"
      gt_path: "data/test_2/gt_data_2.md"
      language: "korean"
      document_type: "scanned"
      features: ["tables", "structured_text"]

    - id: "test_3"
      name: "Academic Paper"
      pdf_path: "data/test_3/Chain-of-Thought-Prompting-Elicits-Reasoning-in-Large-Language-Models.pdf"
      gt_path: "data/test_3/gt_data_3.md"
      language: "english"
      document_type: "digital"
      features: ["multi_column", "tables", "figures", "references"]

# =============================================================================
# Parser Configuration
# =============================================================================
parsers:
  vlm:
    model: "Qwen3-VL-2B-Instruct"
    api_url: "http://localhost:8000/v1/chat/completions"
    temperature: 0.0
    max_tokens: 4096
    timeout: 60
    image_dpi: 300
    prompt_version: "v2"

  pdfplumber:
    enabled: true
    table_settings:
      vertical_strategy: "lines"
      horizontal_strategy: "lines"
      snap_tolerance: 3
    text_settings:
      x_tolerance: 3
      y_tolerance: 3

  docling:
    enabled: true
    ocr_engine: "rapidocr"
    enable_table_detection: true
    enable_layout_analysis: true

# =============================================================================
# Chunking Configuration (FIXED for all experiments)
# =============================================================================
chunking:
  strategy: "recursive_character"
  chunk_size: 500
  chunk_overlap: 50
  separators:
    - "\n\n"
    - "\n"
    - ". "
    - " "
  length_function: "character_count"

# =============================================================================
# Embedding Configuration
# =============================================================================
embedding:
  model: "jhgan/ko-sroberta-multitask"
  dimension: 768
  normalize: true
  batch_size: 32
  device: "cuda"  # or "cpu"

# =============================================================================
# Retrieval Configuration
# =============================================================================
retrieval:
  method: "cosine_similarity"
  top_k: [1, 3, 5, 10]
  threshold: 0.0

# =============================================================================
# Q&A Generation Configuration
# =============================================================================
qa_generation:
  questions_per_document: 15
  question_types:
    factual:
      count: 5
      description: "Direct fact retrieval"
    table_lookup:
      count: 4
      description: "Information from tables"
    multi_hop:
      count: 3
      description: "Combine multiple facts"
    inferential:
      count: 3
      description: "Reasoning required"
  llm_provider: "openai"  # or "anthropic"
  llm_model: "gpt-4"
  temperature: 0.3

# =============================================================================
# Evaluation Metrics
# =============================================================================
metrics:
  lexical:
    cer:
      enabled: true
      library: "jiwer"
    wer:
      enabled: true
      tokenizer: "mecab"  # mecab, okt, whitespace

  structural:
    boundary_score:
      enabled: true
      tolerance_chars: 50
    chunk_score:
      enabled: true

  retrieval:
    hit_rate:
      enabled: true
      k_values: [1, 3, 5, 10]
    mrr:
      enabled: true
    ndcg:
      enabled: false  # Optional

# =============================================================================
# Normalization Settings
# =============================================================================
normalization:
  strip_markdown: true
  normalize_whitespace: true
  unicode_normalization: "NFKC"
  lowercase: false
  remove_punctuation: false

# =============================================================================
# Quality Thresholds
# =============================================================================
thresholds:
  cer:
    excellent: 0.02
    good: 0.05
    acceptable: 0.10
  wer:
    excellent: 0.05
    good: 0.10
    acceptable: 0.20
  hit_rate:
    excellent: 0.90
    good: 0.75
    acceptable: 0.60

# =============================================================================
# Ablation Study Configuration
# =============================================================================
ablation:
  prompt_variations:
    - version: "v1"
      name: "extraction_expert"
      enabled: true
    - version: "v2"
      name: "transcription_engine"
      enabled: true
    - version: "v3"
      name: "minimal"
      enabled: true
    - version: "v4"
      name: "xml_structured"
      enabled: false

  resolution_variations:
    - dpi: 72
      enabled: true
    - dpi: 150
      enabled: true
    - dpi: 300
      enabled: true

  chunking_variations:
    - strategy: "fixed"
      chunk_size: 500
      enabled: true
    - strategy: "fixed"
      chunk_size: 1000
      enabled: true
    - strategy: "semantic"
      enabled: false  # Requires additional implementation

# =============================================================================
# Output Configuration
# =============================================================================
output:
  results_dir: "results"
  save_intermediate: true
  formats:
    - "json"
    - "csv"
  timestamp_results: true

# =============================================================================
# Reproducibility
# =============================================================================
reproducibility:
  random_seed: 42
  log_level: "INFO"
  save_configs: true
